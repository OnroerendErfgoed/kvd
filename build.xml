<?xml version="1.0" ?>

<project name="kvd" default="main" basedir="/data/projects/kvd/kvd/">

	<property name="projectsDir" value="/data/projects/kvd" />

	<property name="kvdLibDir" value="${projectsDir}/kvd" />
	<property name="kvdSqlDir" value="${projectsDir}/kvd/sql" />
	<property name="docsDir" value="/data/docs/kvd/kvd" />
	<property name="agaviDir" value="/opt/csw/php5/lib/php/agavi/" />

	<target name="main" description="Overzicht van de mogelijke taken">
		<echo msg="U kunt volgende taken uitvoeren:" />
		<echo msg=" createSchema:	Maak de db-schema's van KVD_adr aan." />
		<echo msg=" clearCrabCache: Maak de crab cache leeg." />
		<echo msg=" createCrabPackage: Genereer een pakket met de crab classes." />
		<echo msg=" docs: Maak de API-documentatie aan." />
	</target>

	<target name="createSchema" description="Maak de schema's van deze applicatie aan.">
		<echo msg="Bestaande schema's worden verwijderd." />
		<sql url="pgsql://oeibeheerder:jawwmefe@localhost/oei" autocommit="on" onerror="continue">
			DROP SCHEMA kvd_adr CASCADE;
		</sql>
		<echo msg="Bezig met aanmaken van schema kvd_adr." />
		<sql url="pgsql://oeibeheerder:jawwmefe@localhost/oei" src="${kvdSqlDir}/dbcreate/kvd_adr.psql" autocommit="off" onerror="abort"/>
		<echo msg="Bezig met toekennen van rechten op schema kvd_adr." />
		<sql url="pgsql://oeibeheerder:jawwmefe@localhost/oei" src="${kvdSqlDir}/usergrant/kvd_adr.psql" autocommit="off" onerror="abort"/>
		<echo msg="Bezig met vullen van de gemeentelijst." />
		<sql url="pgsql://oeibeheerder:jawwmefe@localhost/oei" src="${kvdSqlDir}/dbcreate/kvd_adr_fill_gemeenten.psql" autocommit="off" onerror="abort"/>
		<echo msg="Bezig met vullen van de deelgemeentelijst." />
		<sql url="pgsql://oeibeheerder:jawwmefe@localhost/oei" src="${kvdSqlDir}/dbcreate/kvd_adr_fill_deelgemeenten.psql" autocommit="off" onerror="abort"/>
	</target>

	<target name="clearCrabCache" description="Leeg de crab Cache.">
		<echo msg="Alle bestanden in de crabcache worden gewist." />
		<echo msg="Mogelijk mislukt dit omdat u geen schrijfrechten heb op de map." />
		<delete verbose="true" >
			<fileset dir="/tmp/crabcache">
				<include name="*.crbcache" />
			</fileset>
		</delete>
	</target>

	<target name="createCrabPackage" description="Genereer een pakket met de crab classes.">
		<property name="builddir"  value="${user.home}/phpCrab" />
		<mkdir dir="${builddir}" />
		<mkdir dir="${builddir}/docs" />
		<copy todir="${builddir}/classes/gis">
			<fileset dir="classes/gis" >
				<include name="crab/*.class.php" />
				<include name="geometry/*.class.php" />
				<exclude name="geometry/KVDgis_GeomPolygon.class.php" />
				<exclude name="geometry/KVDgis_GeomLine.class.php" />
			</fileset>
		</copy>
		<copy todir="${builddir}/classes/util">
			<fileset dir="classes/util" >
				<include name="KVDutil_CacheFile.class.php" />
				<include name="KVDutil_HuisnummerLabelSplitter.class.php" />
				<include name="KVDutil_XMLSecurityKey.class.php" />
				<include name="Gateway/*.class.php" />
				<include name="soap/*.class.php" />
			</fileset>
		</copy>
		<copy todir="${builddir}/tests">
			<fileset dir="tests">
				<include name="KVDgis_all.test.php" />
			</fileset>
		</copy>
		<copy todir="${builddir}/tests/gis">
			<fileset dir="tests/gis">
				<include name="crab/*.test.php" />
				<include name="geometry/*.test.php" />
			</fileset>
		</copy>
		<copy todir="${builddir}/tests/util">
			<fileset dir="tests/util">
				<include name="KVDutil_GatewayFactory.test.php" />
				<include name="KVDutil_GatewayRegistry.test.php" />
				<include name="KVDutil_HuisnummerLabelSplitter.test.php" />
			</fileset>
		</copy>
		<copy file="doc/phpCrab/README.TXT" toFile="${builddir}/README.TXT" />
		<echo msg="De html documentatie wordt nu aangemaakt." />
		<phpdoc title="phpCrab documentatie" destdir="${builddir}/docs" sourcepath="${builddir}/classes" output="HTML:frames:earthli" />
		<echo msg="Er wordt een archief aangemaakt." />
		<tar destfile="${user.home}/phpCrab.tar.gz" basedir="${builddir}" compression="gzip" />
		<delete dir="${builddir}" />
	</target>

	<target name="docs" description="Maak de API-documentatie voor de KVDlib en Agavi aan.">
		<echo msg="De API-documentatie voor de KVDlib wort aangemaakt. Dit kan even duren." />
		<phpdoc title="KVDlib API documentatie" destdir="${docsDir}" output="HTML:frames:earthli" sourcepath="${kvdLibDir}/classes/,${agaviDir}" />
	</target>
</project>
